# slack-attendance
Google Apps Script（以下GAS）で動作する勤怠打刻bot
現段階ではslackの旧Webhooksの仕様に則って作成しています。
`https://{workspace-name}.slack.com/apps`のURLから設定するIncoming Webhooks及びOutgoing Webhooksを利用します。

## SETUP
### 1. コード挿入
main.gsのコードを全てコピーしてGASのプロジェクトに貼り付けます。

### 2. 変数設定
コード上部に定義している変数にそれぞれ使うslack webhooksのURLなどを挿入します。

### 3. ディレクトリのセットアップ（setUp()関数の実行）
GAS編集画面上「関数の実行→setUp()→実行」にてセットアップを手動実行し、メッセージ設定ファイル、シートの格納ディレクトリを作成します。

### 4. 公開
「公開→ウェブアプリケーションとして公開」から、公開設定を「Anyone,even anonymous」に設定して公開し、GASで生成されたURLをSlack Outgoing Webhooksに設定します。

### 5. Slack Outgoing Webhooksの設定
上記「4. 公開」で生成したURLを設定します。投稿チャンネルには好きなところを設定してください。トリガーには「出勤,退勤,休憩,戻り,有給,半休,代休」をそのまま入力してください。（トリガーはコード部分と合わせて調整してください。）

### 6. 動作確認
「5. outgoing webhooksの設定」で設定したトリガーを設定したチャンネルで投稿し、botから自身へのメンション付きのレスポンスがあり、任意のシートの生成と打刻が確認されたら正常に動作しています。

## 仕様について
### 一般的な打刻周りについて
今のところは、Webhookのトリガーに設定したワードを検出して、送信ユーザーの名前のファイル生成・その月のシート作成・送信時間での打刻まで行ってくれるはずです。
※生成されたシートに今日やることなどの項目がありますが、現段階では打刻以外の項目は未対応です。

また、0時〜1時台の「退勤」の打刻は前日の退勤枠への打刻として扱うようになっています。185~187行目をコメントアウトするとこの仕様は解除できます。

### 休日の設定
有給、半休、代休の打刻に対応しています。
フォーマットは「有給（休暇の種類）,Y/m/d」となっています。
